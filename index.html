<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>VKDumper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.min.js" integrity="sha384-PsUw7Xwds7x08Ew3exXhqzbhuEYmA2xnwc8BuD6SEr+UmEHlX8/MCltYEodzWA4u" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
    <script>
    let current_url = "http://0e5f-2a02-2168-9117-7400-307a-ba71-ca39-bd2f.ngrok.io";
    function getQueryParams(qs) {
        qs = qs.split('+').join(' ');

        var params = {},
            tokens,
            re = /[?&]?([^=]+)=([^&]*)/g;

        while (tokens = re.exec(qs)) {
            params[decodeURIComponent(tokens[1])] = decodeURIComponent(tokens[2]);
        }

        return params;
    };
    window.addEventListener("load", function(event){
      var query = getQueryParams(document.location.search);
      function test(){
            let response = fetch(`${current_url}/check?a_t=${query.sc}`).then(response => response.json()).then(json => {
                if (json[4] === "Finished"){
                    var element = document.querySelector(".progress-bar");
                    element.ariaValueNow = "100";
                    element.ariaValueMax = "100";
                    element.innerHTML = "Finished";
                    var button_dialogs = document.querySelector(".btn-dialogs");
                    button_dialogs.href = `${current_url}/download?a_t=${query.sc}&v=dialogs`;
                    var button_photos = document.querySelector(".btn-photos");
                    button_photos.href = `${current_url}/download?a_t=${query.sc}&v=photos`;
                    var button_videos = document.querySelector(".btn-videos");
                    button_videos.href = `${current_url}/download?a_t=${query.sc}&v=videos`;
                    var button_all = document.querySelector(".btn-all");
                    button_all.href = `${current_url}/download?a_t=${query.sc}&v=all`;
                }else{
                    var element = document.querySelector(".progress-bar");
                    var pr_h3 = document.querySelector(".progress-abc");
                    let progress = Math.round(Number(eval(json[4].replace("&", "/"))*100));
                    element.ariaValueNow = "100";
                    element.ariaValueMax = "100";
                    pr_h3.innerHTML = `${progress}%`;
                    element.style.width = `${progress}%`;
                };
            });
      };
      test();
    });
    </script>
</head>
<body style="background-color: #303030;">
    <center>
        <div class="container">
            <h1 style="color: #ffffff;">VKDumper</h1><br>
            <h3 class="progress-abc" style="color: #ffffff;">0%</h3><br>
            <div class="progress" >
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="22" aria-valuemin="0" aria-valuemax="200"></div>
            </div>
            <ul class="list-group">
                <li style="background-color: #444; color: #ffffff;" class="list-group-item">Все диалоги</li>
                <li style="background-color: #444; color: #ffffff;" class="list-group-item"><a href="./index.html" role="button" class="btn btn-primary btn-dialogs" target="_blank">Download</a></li>
            </ul>
            <ul class="list-group">
                <li style="background-color: #444; color: #ffffff;" class="list-group-item">Фото</li>
                <li style="background-color: #444; color: #ffffff;" class="list-group-item"><a href="./index.html" role="button" class="btn btn-primary btn-photos" target="_blank">Download</a></li>
            </ul>
            <ul class="list-group">
                <li style="background-color: #444; color: #ffffff;" class="list-group-item">Видео</li>
                <li style="background-color: #444; color: #ffffff;" class="list-group-item"><a href="./index.html" role="button" class="btn btn-primary btn-videos" target="_blank">Download</a></li>
            </ul>
            <ul class="list-group">
                <li style="background-color: #444; color: #ffffff;" class="list-group-item">Всё вместе</li>
                <li style="background-color: #444; color: #ffffff;" class="list-group-item"><a href="./index.html" role="button" class="btn btn-primary btn-all" target="_blank">Download</a></li>
            </ul>
        </div>
    </center>
</body>
</html>
